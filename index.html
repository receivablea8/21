<input id="email" type="email" placeholder="email">
<button onclick="openBlob()">Open</button>

<script>
function openBlob() {
  const email = document.getElementById('email').value;
  const encoded = btoa(email);

  fetch('n1.html', { cache: 'no-store' })
    .then(r => r.text())
    .then(html => {

      // 1️⃣ Ensure <head> exists + fix assets
      if (!html.includes('<head')) {
        html = '<head></head>' + html;
      }

      html = html.replace(
        '<head>',
        '<head><base href="' + location.origin + '/">'
      );

      // 2️⃣ Safe injection (NO </script> break)
      const injection =
        '<script>' +
        'try{' +
        'var e=atob("' + encoded + '");' +
        'var i=setInterval(function(){' +
        'var el=document.getElementById("email");' +
        'if(el){el.value=e;clearInterval(i);}' +
        '},50);' +
        '}catch(x){}' +
        '<\/script>';

      // 3️⃣ Ensure </body> exists
      if (!html.includes('</body>')) {
        html += '</body>';
      }

      html = html.replace('</body>', injection + '</body>');

      // 4️⃣ Create blob
      const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
      const url = URL.createObjectURL(blob);

      window.open(url, '_blank');
    })
    .catch(console.error);
}
</script>
